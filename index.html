<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo Equipment Tracker</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="page">
      <header class="hero">
        <div>
          <p class="eyebrow">Operations</p>
          <h1>Demonstration Equipment Tracker</h1>
          <p class="subhead">
            Find where every kit is located, and log moves between offices, the workshop, and
            customer hires.
          </p>
          <p class="subhead">Build: CONDITION_PILL_FIX_2026-02-10</p>
        </div>
      </header>

      <div class="tab-controls">
        <nav
          class="tabs"
          role="tablist"
          aria-label="Equipment tracker sections"
        >
          <button
            class="tab-button"
            type="button"
            id="tab-button-operations"
            role="tab"
            aria-selected="true"
            aria-controls="tab-operations"
            data-tab="operations"
          >
            Operations
          </button>
          <button
            class="tab-button"
            type="button"
            id="tab-button-moves"
            role="tab"
            aria-selected="false"
            aria-controls="tab-moves"
            data-tab="moves"
          >
            Moves
          </button>
          <button
            class="tab-button"
            type="button"
            id="tab-button-admin"
            role="tab"
            aria-selected="false"
            aria-controls="tab-admin"
            data-tab="admin"
          >
            Admin
          </button>
        </nav>
        <div class="admin-controls">
          <label class="admin-toggle" for="admin-mode-toggle">
            <input id="admin-mode-toggle" type="checkbox" />
            <span>Admin mode</span>
          </label>
          <p class="admin-toggle-note">
            Admin mode is a local browser control, not enterprise authentication.
          </p>
        </div>
      </div>

      <main>
        <div id="operations-view">
          <section
            id="tab-operations"
            class="tab-panel"
            role="tabpanel"
            aria-labelledby="tab-button-operations"
          >
            <div class="stats" aria-live="polite">
              <div>
                <span class="stat-label">Tracked items</span>
                <strong id="stat-total">0</strong>
              </div>
              <div>
                <span class="stat-label">On hire</span>
                <strong id="stat-hire">0</strong>
              </div>
              <div>
                <span class="stat-label">Overdue calibration</span>
                <strong id="stat-overdue">0</strong>
              </div>
              <div>
                <span class="stat-label">Due soon calibration</span>
                <strong id="stat-due-soon">0</strong>
              </div>
              <div>
                <span class="stat-label">Overdue subscription</span>
                <strong id="stat-overdue-subscription">0</strong>
              </div>
              <div>
                <span class="stat-label">Due soon subscription</span>
                <strong id="stat-due-soon-subscription">0</strong>
              </div>
            </div>

            <div class="grid">
              <section class="card">
                <div class="card-header">
                  <div>
                    <h2>Find equipment</h2>
                    <p>Search by equipment name, location, or status.</p>
                  </div>
                  <div class="filters">
                    <div class="filter">
                      <label for="location-filter">Location</label>
                      <select id="location-filter"></select>
                    </div>
                    <div class="filter">
                      <label for="status-filter">Status</label>
                      <select id="status-filter"></select>
                    </div>
                    <div class="filter">
                      <label for="calibration-filter">Calibration</label>
                      <select id="calibration-filter"></select>
                    </div>
                    <div class="filter">
                      <label for="subscription-filter">Subscription</label>
                      <select id="subscription-filter"></select>
                    </div>
                  </div>
                </div>
                <div class="search">
                  <input
                    id="search-input"
                    type="search"
                    placeholder="Search equipment..."
                    autocomplete="off"
                  />
                </div>
                <div class="table-wrapper">
                  <table>
                    <thead>
                      <tr>
                        <th>Equipment</th>
                        <th>Model</th>
                        <th>Serial</th>
                        <th>Status</th>
                        <th>Location</th>
                        <th>Calibration</th>
                        <th>Subscription</th>
                        <th>Condition</th>
                        <th>Last moved</th>
                      </tr>
                    </thead>
                    <tbody id="equipment-table"></tbody>
                  </table>
                </div>

                <div class="location-summary">
                  <div class="summary-header">
                    <h3>Location overview</h3>
                    <p>Quick counts and assigned equipment per location.</p>
                  </div>
                  <div
                    id="location-summary"
                    class="summary-grid"
                    aria-live="polite"
                  ></div>
                </div>
              </section>

              <section class="card">
                <h2>Console</h2>
                <p>Use the console to log equipment moves.</p>

                <div class="console console--operations">
                  <form id="move-form" class="panel">
                    <h3>Log a move</h3>
                    <label>
                      Equipment
                      <select id="move-equipment"></select>
                    </label>
                    <label>
                      New location
                      <select id="move-location"></select>
                    </label>
                    <label>
                      Status (optional)
                      <select id="move-status"></select>
                    </label>
                    <label>
                      Notes (optional)
                      <input
                        id="move-notes"
                        type="text"
                        placeholder="Customer name, demo date..."
                      />
                    </label>
                    <fieldset id="move-shipping-section" class="shipping-section">
                      <legend>Shipping details (optional)</legend>
                      <label>
                        Carrier / Courier
                        <select id="move-shipping-carrier">
                          <option value="">Select carrier...</option>
                          <option value="Team Global Express">Team Global Express</option>
                          <option value="TNT/FedEx">TNT/FedEx</option>
                          <option value="DHL">DHL</option>
                          <option value="StarTrack">StarTrack</option>
                          <option value="Toll">Toll</option>
                          <option value="Other">Other</option>
                        </select>
                      </label>
                      <label>
                        Tracking number
                        <input id="move-shipping-tracking" type="text" />
                      </label>
                      <label>
                        Ship date
                        <input id="move-shipping-ship-date" type="date" />
                      </label>
                      <label>
                        ETA date
                        <input id="move-shipping-eta-date" type="date" />
                      </label>
                      <p id="move-shipping-override-note" class="field-warning is-hidden">
                      Shipping details are active: status is shown as <strong>In transit</strong> until received.
                    </p>
                      <p id="move-shipping-validation" class="field-error is-hidden"></p>
                    </fieldset>
                    <div class="condition-section">
                      <h4>Condition check</h4>
                      <p
                        id="move-condition-exempt-note"
                        class="field-note is-hidden"
                      >
                        Condition check not required for this status.
                      </p>
                      <div class="condition-grid">
                        <label>
                          Condition rating
                          <select id="move-condition-rating">
                            <option value="" selected>Select...</option>
                            <option value="Excellent">Excellent</option>
                            <option value="Good">Good</option>
                            <option value="Fair">Fair</option>
                            <option value="Needs attention">Needs attention</option>
                            <option value="Unserviceable">Unserviceable</option>
                          </select>
                        </label>
                        <label>
                          Contents OK?
                          <select id="move-contents-ok">
                            <option value="" selected>Select...</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                          </select>
                        </label>
                        <label>
                          Functional OK?
                          <select id="move-functional-ok">
                            <option value="" selected>Select...</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                          </select>
                        </label>
                      </div>
                      <label>
                        Condition notes
                        <textarea
                          id="move-condition-notes"
                          rows="3"
                          placeholder="Record any issues if checks failed..."
                        ></textarea>
                        <span
                          id="move-condition-notes-error"
                          class="field-error is-hidden"
                        >
                          Please add notes for failed checks.
                        </span>
                      </label>
                      <details class="reference-panel">
                        <summary>What should I check?</summary>
                        <div class="reference-panel-body">
                          <div class="reference-section">
                            <h5>Contents checklist</h5>
                            <ul
                              id="move-contents-checklist"
                              class="reference-list"
                            ></ul>
                            <p
                              id="move-contents-checklist-empty"
                              class="reference-empty"
                            >
                              No reference defined for this equipment.
                            </p>
                          </div>
                          <div class="reference-section">
                            <h5>Functional check guide</h5>
                            <ul
                              id="move-functional-checklist"
                              class="reference-list"
                            ></ul>
                            <p
                              id="move-functional-checklist-empty"
                              class="reference-empty"
                            >
                              No reference defined for this equipment.
                            </p>
                          </div>
                        </div>
                      </details>
                    </div>
                    <p
                      id="move-checklist-lock"
                      class="field-warning is-hidden"
                    >
                      This equipment does not have a condition checklist
                      defined. An admin must define it before it can be moved.
                      <button
                        type="button"
                        class="link-button"
                        id="move-checklist-admin-link"
                      >
                        Go to Admin â†’ Edit equipment
                      </button>
                    </p>
                    <p
                      id="move-submit-blocked"
                      class="field-warning is-hidden"
                    >
                      Condition check required for this move.
                    </p>
                    <button type="submit" id="move-submit">
                      Record move
                    </button>
                  </form>
                </div>

                <div class="history">
                  <div class="history-header">
                    <h3>Recent moves</h3>
                    <button id="clear-history" type="button">
                      Archive history
                    </button>
                  </div>
                  <ul id="history-list"></ul>
                </div>
              </section>
            </div>

          </section>
        </div>

        <div id="moves-view" hidden>
          <section
            id="tab-moves"
            class="tab-panel"
            role="tabpanel"
            aria-labelledby="tab-button-moves"
          >
            <section class="card">
              <div class="card-header">
                <div>
                  <h2>Moves log</h2>
                  <p>
                    Review every recorded move, calibration, subscription, and
                    update.
                  </p>
                </div>
                <div class="filters">
                  <div class="filter">
                    <label for="moves-equipment-filter">Equipment</label>
                    <select id="moves-equipment-filter"></select>
                  </div>
                  <div class="filter">
                    <label for="moves-type-filter">Type</label>
                    <select id="moves-type-filter"></select>
                  </div>
                  <div class="filter">
                    <label for="moves-destination-filter">Destination</label>
                    <select id="moves-destination-filter"></select>
                  </div>
                  <div class="filter">
                    <label class="checkbox-field">
                      Show deleted
                      <input id="moves-show-deleted" type="checkbox" />
                    </label>
                  </div>
                  <div class="filter">
                    <label class="checkbox-field">
                      Requiring receipt
                      <input id="moves-receipt-only" type="checkbox" />
                    </label>
                  </div>
                </div>
              </div>
              <div class="search">
                <input
                  id="moves-search"
                  type="search"
                  placeholder="Search moves and notes..."
                  autocomplete="off"
                />
              </div>
              <div class="table-wrapper">
                <table>
                  <thead id="moves-table-header"></thead>
                  <tbody id="moves-table-body"></tbody>
                </table>
              </div>
            </section>
          </section>
        </div>

        <div id="admin-view" hidden>
          <section
            id="tab-admin"
            class="tab-panel"
            role="tabpanel"
            aria-labelledby="tab-button-admin"
          >
            <section class="card">
              <h2>Administration</h2>
              <p>Use these tools to add or update equipment records.</p>

              <div class="console">
                <form id="admin-passcode-settings" class="panel">
                  <h3>Admin passcode</h3>
                  <p class="panel-hint">
                    This passcode is stored only in this browser (not enterprise
                    authentication). Clearing local storage resets it.
                  </p>
                  <label>
                    Current passcode
                    <input id="admin-passcode-current" type="password" />
                  </label>
                  <label>
                    New passcode
                    <input id="admin-passcode-update" type="password" />
                  </label>
                  <label>
                    Confirm new passcode
                    <input id="admin-passcode-update-confirm" type="password" />
                  </label>
                  <p
                    id="admin-passcode-update-error"
                    class="field-error is-hidden"
                  ></p>
                  <p
                    id="admin-passcode-update-success"
                    class="field-success is-hidden"
                  >
                    Passcode updated.
                  </p>
                  <button type="submit">Update passcode</button>
                </form>

                <form id="calibration-form" class="panel">
                  <h3>Record calibration</h3>
                  <label>
                    Equipment
                    <select id="calibration-equipment"></select>
                  </label>
                  <label>
                    Calibration date
                    <input id="calibration-date" type="date" />
                  </label>
                  <label>
                    Interval months (optional override)
                    <input
                      id="calibration-interval"
                      type="number"
                      min="1"
                      step="1"
                      placeholder="e.g. 18"
                    />
                  </label>
                  <label class="checkbox-field">
                    Calibration required
                    <input id="calibration-required" type="checkbox" />
                  </label>
                  <button type="submit">Save calibration</button>
                </form>

                <form id="add-equipment-form" class="panel">
                  <h3>Add new equipment</h3>
                  <label>
                    Equipment name
                    <input id="new-equipment-name" type="text" required />
                  </label>
                  <label>
                    Model
                    <input id="new-equipment-model" type="text" />
                  </label>
                  <label>
                    Serial number
                    <input id="new-equipment-serial" type="text" />
                    <span
                      id="new-equipment-serial-warning"
                      class="field-warning is-hidden"
                    >
                      Another item already has this serial number.
                    </span>
                  </label>
                  <label>
                    Purchase date
                    <input id="new-equipment-purchase-date" type="date" />
                  </label>
                  <label>
                    Starting location
                    <select id="new-equipment-location"></select>
                  </label>
                  <label>
                    Status
                    <select id="new-equipment-status"></select>
                  </label>
                  <label class="checkbox-field">
                    Calibration required
                    <input
                      id="new-equipment-calibration-required"
                      type="checkbox"
                      checked
                    />
                  </label>
                  <label id="new-equipment-calibration-interval-field">
                    Calibration interval
                    <select id="new-equipment-calibration-interval">
                      <option value="12">12 months</option>
                      <option value="24">24 months</option>
                      <option value="custom">Custom</option>
                    </select>
                  </label>
                  <label
                    id="new-equipment-calibration-interval-custom-field"
                    class="is-hidden"
                  >
                    Custom interval (months)
                    <input
                      id="new-equipment-calibration-interval-custom"
                      type="number"
                      min="1"
                      step="1"
                      placeholder="e.g. 18"
                    />
                  </label>
                  <label id="new-equipment-last-calibration-field">
                    Last calibration date
                    <input id="new-equipment-last-calibration" type="date" />
                  </label>
                  <label class="checkbox-field">
                    Subscription required
                    <input
                      id="new-equipment-subscription-required"
                      type="checkbox"
                    />
                  </label>
                  <label id="new-equipment-subscription-date-field">
                    Subscription renewal date
                    <input
                      id="new-equipment-subscription-date"
                      type="date"
                    />
                  </label>
                  <button type="submit">Add equipment</button>
                </form>

                <form id="edit-equipment-form" class="panel">
                  <h3>Edit equipment</h3>
                  <label>
                    Equipment
                    <select id="edit-equipment-select"></select>
                  </label>
                  <label>
                    Equipment name
                    <input id="edit-equipment-name" type="text" required />
                    <span
                      id="edit-equipment-name-error"
                      class="field-error is-hidden"
                    >
                      Equipment name is required.
                    </span>
                    <span
                      id="edit-equipment-name-warning"
                      class="field-warning is-hidden"
                    >
                      Another item already uses this name.
                    </span>
                  </label>
                  <label>
                    Model
                    <input id="edit-equipment-model" type="text" />
                  </label>
                  <label>
                    Serial number
                    <input id="edit-equipment-serial" type="text" />
                    <span
                      id="edit-equipment-serial-warning"
                      class="field-warning is-hidden"
                    >
                      Another item already has this serial number.
                    </span>
                  </label>
                  <label>
                    Purchase date
                    <input id="edit-equipment-purchase-date" type="date" />
                  </label>
                  <label>
                    Physical location
                    <select id="edit-equipment-location"></select>
                  </label>
                  <label>
                    Status
                    <select id="edit-equipment-status"></select>
                  </label>
                  <label class="checkbox-field">
                    Calibration required
                    <input
                      id="edit-equipment-calibration-required"
                      type="checkbox"
                    />
                  </label>
                  <label id="edit-equipment-calibration-interval-field">
                    Calibration interval
                    <select id="edit-equipment-calibration-interval">
                      <option value="12">12 months</option>
                      <option value="24">24 months</option>
                      <option value="custom">Custom</option>
                    </select>
                  </label>
                  <label
                    id="edit-equipment-calibration-interval-custom-field"
                    class="is-hidden"
                  >
                    Custom interval (months)
                    <input
                      id="edit-equipment-calibration-interval-custom"
                      type="number"
                      min="1"
                      step="1"
                      placeholder="e.g. 18"
                    />
                  </label>
                  <label id="edit-equipment-last-calibration-field">
                    Last calibration date
                    <input id="edit-equipment-last-calibration" type="date" />
                  </label>
                  <label class="checkbox-field">
                    Subscription required
                    <input
                      id="edit-equipment-subscription-required"
                      type="checkbox"
                    />
                  </label>
                  <label id="edit-equipment-subscription-date-field">
                    Subscription renewal date
                    <input
                      id="edit-equipment-subscription-date"
                      type="date"
                    />
                  </label>
                  <label>
                    Contents checklist (reference)
                    <textarea
                      id="edit-equipment-contents-checklist"
                      rows="4"
                      placeholder="List contents to verify, one per line..."
                    ></textarea>
                  </label>
                  <label>
                    Functional check guide (reference)
                    <textarea
                      id="edit-equipment-functional-checklist"
                      rows="4"
                      placeholder="List functional checks, one per line..."
                    ></textarea>
                  </label>
                  <div class="copy-checklist">
                    <label>
                      Copy checklist from
                      <select id="edit-equipment-copy-source">
                        <option value="">Select equipment...</option>
                      </select>
                    </label>
                    <button
                      type="button"
                      id="edit-equipment-copy-button"
                      disabled
                    >
                      Copy checklist
                    </button>
                    <span
                      id="edit-equipment-copy-warning"
                      class="field-warning is-hidden"
                    ></span>
                  </div>
                  <div class="panel-actions">
                    <button type="submit">Save changes</button>
                    <button
                      type="button"
                      class="button-secondary"
                      id="edit-equipment-cancel"
                    >
                      Cancel
                    </button>
                  </div>
                </form>

                <div class="panel import-panel">
                  <h3>Import equipment</h3>
                  <p class="panel-hint">
                    Upload a CSV to bulk add equipment. Existing items are never
                    removed. Dates accepted: yyyy-mm-dd or dd/mm/yyyy. Excel serial dates also supported.
                  </p>
                  <div class="panel-actions">
                    <button type="button" id="import-template-button">
                      Download CSV template
                    </button>
                  </div>
                  <label>
                    CSV file
                    <input
                      id="import-file-input"
                      type="file"
                      accept=".csv"
                    />
                  </label>
                  <label>
                    On duplicate serial
                    <select id="import-duplicate-behavior">
                      <option value="skip" selected>Skip</option>
                      <option value="import">Import anyway</option>
                    </select>
                  </label>
                  <div class="import-summary" id="import-summary" aria-live="polite">
                    <div>
                      <span class="import-label">Rows detected</span>
                      <strong id="import-total-count">0</strong>
                    </div>
                    <div>
                      <span class="import-label">Valid</span>
                      <strong id="import-valid-count">0</strong>
                    </div>
                    <div>
                      <span class="import-label">Invalid</span>
                      <strong id="import-invalid-count">0</strong>
                    </div>
                  </div>
                  <div class="import-preview">
                    <p id="import-empty-state" class="import-empty">
                      Select a CSV file to preview the import.
                    </p>
                    <div class="import-preview-table table-wrapper is-hidden">
                      <table>
                        <thead id="import-preview-header"></thead>
                        <tbody id="import-preview-body"></tbody>
                      </table>
                    </div>
                  </div>
                  <div class="import-warnings">
                    <h4>Warnings</h4>
                    <ul id="import-warnings" class="import-warning-list">
                      <li class="import-empty">No warnings yet.</li>
                    </ul>
                  </div>
                  <div class="panel-actions">
                    <button type="button" id="import-submit" disabled>
                      Import
                    </button>
                    <button
                      type="button"
                      class="button-secondary"
                      id="import-clear"
                    >
                      Clear
                    </button>
                  </div>
                </div>
              </div>
            </section>
          </section>
        </div>
      </main>
    </div>


    <dialog id="condition-history-modal" class="condition-history-modal">
      <div class="condition-history-header">
        <h3 id="condition-history-title">Condition history</h3>
        <button type="button" class="icon-button" id="condition-history-close">Close</button>
      </div>
      <ul id="condition-history-list" class="condition-history-list"></ul>
    </dialog>

    <dialog id="correction-modal" class="admin-passcode-dialog correction-dialog">
      <form id="correction-form" class="panel" novalidate>
        <h3>Add correction</h3>
        <p class="panel-hint" id="correction-target-label"></p>

        <fieldset class="correction-grid">
          <legend>Fields to correct</legend>
          <label class="checkbox-field">
            <input type="checkbox" id="correction-field-shipping" />
            Shipping tracking
          </label>
          <label>
            <input id="correction-shipping-tracking" type="text" />
          </label>

          <label class="checkbox-field">
            <input type="checkbox" id="correction-field-receipt" />
            Receipt date
          </label>
          <label>
            <input id="correction-receipt-date" type="date" />
          </label>

          <label class="checkbox-field">
            <input type="checkbox" id="correction-field-from" />
            From location
          </label>
          <label>
            <select id="correction-from-location"></select>
          </label>

          <label class="checkbox-field">
            <input type="checkbox" id="correction-field-to" />
            To location
          </label>
          <label>
            <select id="correction-to-location"></select>
          </label>

          <label class="checkbox-field">
            <input type="checkbox" id="correction-field-condition" />
            Condition rating
          </label>
          <label>
            <select id="correction-condition-rating">
              <option value="">Select...</option>
              <option value="Excellent">Excellent</option>
              <option value="Good">Good</option>
              <option value="Fair">Fair</option>
              <option value="Needs attention">Needs attention</option>
              <option value="Unserviceable">Unserviceable</option>
            </select>
          </label>

          <label class="checkbox-field">
            <input type="checkbox" id="correction-field-notes" />
            Notes
          </label>
          <label>
            <textarea id="correction-notes" rows="2"></textarea>
          </label>
        </fieldset>

        <label>
          Reason
          <textarea id="correction-reason" rows="2" required></textarea>
        </label>
        <p id="correction-error" class="field-error is-hidden"></p>
        <div class="dialog-actions">
          <button type="button" class="button-secondary" id="correction-cancel">Cancel</button>
          <button type="submit">Save correction</button>
        </div>
      </form>
    </dialog>

    <dialog id="correction-details-modal" class="admin-passcode-dialog correction-dialog">
      <div class="panel">
        <div class="condition-history-header">
          <h3>Correction audit trail</h3>
          <button type="button" class="icon-button" id="correction-details-close">Close</button>
        </div>
        <ul id="correction-details-list" class="condition-history-list"></ul>
      </div>
    </dialog>

    <div
      id="toast-container"
      class="toast-container"
      aria-live="polite"
      aria-atomic="true"
    ></div>

    <dialog id="admin-passcode-dialog" class="admin-passcode-dialog">
      <form id="admin-passcode-form" class="panel" novalidate>
        <h3 id="admin-passcode-title">Enable Admin mode</h3>
        <p class="panel-hint" id="admin-passcode-hint">
          Enter the local browser passcode to unlock Admin mode.
        </p>
        <div id="admin-passcode-verify">
          <label>
            Passcode
            <input id="admin-passcode-input" type="password" />
          </label>
        </div>
        <div id="admin-passcode-setup" class="is-hidden">
          <label>
            Set a new passcode
            <input id="admin-passcode-new" type="password" />
          </label>
          <label>
            Confirm passcode
            <input id="admin-passcode-confirm" type="password" />
          </label>
        </div>
        <p id="admin-passcode-error" class="field-error is-hidden"></p>
        <div class="dialog-actions">
          <button
            type="button"
            class="button-secondary"
            id="admin-passcode-cancel"
          >
            Cancel
          </button>
          <button type="submit" id="admin-passcode-submit">
            Enable Admin mode
          </button>
        </div>
      </form>
    </dialog>

    <script type="module" src="src/main.js"></script>
  </body>
</html>
